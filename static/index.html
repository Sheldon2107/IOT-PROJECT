<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ISS Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>html, body, #map {height:100%; margin:0;}</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([0,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker = null;
let poly = L.polyline([], {color:'red'}).addTo(map);

async function updateMap(){
  const res = await fetch('/api/data');
  const data = await res.json();
  poly.setLatLngs(data.map(p=>[p.latitude,p.longitude]));
  if(data.length){
    const last = data[data.length-1];
    if(!marker) marker = L.marker([last.latitude,last.longitude]).addTo(map);
    else marker.setLatLng([last.latitude,last.longitude]);
    map.panTo([last.latitude,last.longitude], {animate:true, duration:0.5});
  }
}

setInterval(updateMap, 5000);
updateMap();
</script>
</body>
</html>
